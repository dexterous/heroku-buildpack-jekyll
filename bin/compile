#!/bin/sh

indent() {
  sed -u 's/^/       /'
}

generate_gemfile() {
cat >> $1/Gemfile <<'EOF'
source :rubygems
gem "jekyll"
EOF
}

generate_config_ru() {
cat >> $1/config.ru <<'EOF'
require "rack/static"
use Rack::Static, urls: ["/"], root: "_site", index: "index.html", headers: { "Cache-Control" => "public" }
run ->(env) { [ 404, {}, [] ] }
EOF
}

echo "-----> Installing dependencies"
if [ ! -f $1/Gemfile ]; then
  generate_gemfile
fi
bundle install --deployment | indent

echo "-----> Compiling Jekyll"
jekyll --no-auto --no-server | indent

echo "-----> Adding config.ru"
generate_config_ru
